{% extends "base.html" %} {% block content %}

<div class="profile-header">
  <h1>Il Mio Profilo</h1>
  <div class="profile-info">
    <div class="info-item">
      <strong>Nome Completo</strong>
      {{ current_user.nome }} {{ current_user.cognome }}
    </div>
    <div class="info-item">
      <strong>Username</strong>
      {{ current_user.username }}
    </div>
    <div class="info-item">
      <strong>Email</strong>
      {{ current_user.email }}
    </div>
    <div class="info-item">
      <strong>Matricola</strong>
      {{ current_user.matricola }}
    </div>
  </div>
  <div style="margin-top: 1.5rem">
    <a href="{{ url_for('edit_profilo') }}" class="btn">Modifica Profilo</a>
  </div>
</div>

<div class="section">
  <h2>Le Mie Prenotazioni</h2>
  {% if prenotazioni %} {% for prenotazione in prenotazioni %}
  <div
    class="prenotazione-card {% if prenotazione.stato == 'pagata' %}pagata{% elif prenotazione.stato == 'cancellata' %}cancellata{% endif %}"
  >
    <div class="prenotazione-header">
      <h3>Menu del {{ prenotazione.menu.data.strftime('%d/%m/%Y') }}</h3>
      <span class="prenotazione-status status-{{ prenotazione.stato }}">
        {{ prenotazione.stato.upper().replace('_', ' ') }}
      </span>
    </div>

    <div class="prenotazione-details">
      <div class="detail-item">
        <strong>Primo:</strong> {{ prenotazione.menu.primo }}
      </div>
      <div class="detail-item">
        <strong>Secondo:</strong> {{ prenotazione.menu.secondo }}
      </div>
      <div class="detail-item">
        <strong>Contorno:</strong> {{ prenotazione.menu.contorno }}
      </div>
      <div class="detail-item">
        <strong>Orario Ritiro:</strong> {{ prenotazione.orario_ritiro }}
      </div>
      <div class="detail-item">
        <strong>Prezzo:</strong> â‚¬{{ "%.2f"|format(prenotazione.menu.prezzo) }}
      </div>
    </div>

    {% if prenotazione.note %}
    <div
      style="
        margin-bottom: 1rem;
        padding: 0.5rem;
        background: white;
        border-radius: 4px;
      "
    >
      <strong>Note:</strong> {{ prenotazione.note }}
    </div>
    {% endif %}

    <div class="action-buttons">
      {% if prenotazione.stato == 'in_attesa' %}
      <a
        href="{{ url_for('pagamento', prenotazione_id=prenotazione.id) }}"
        class="btn btn-success"
      >
        Paga Ora
      </a>
      {% endif %} {% if prenotazione.stato in ['in_attesa', 'pagata'] %}
      <form
        action="{{ url_for('cancella_prenotazione', prenotazione_id=prenotazione.id) }}"
        method="post"
        style="display: inline"
      >
        {{ form.hidden_tag() }}
        <button
          type="submit"
          class="btn btn-danger"
          onclick="return confirm('Sei sicuro di voler cancellare questa prenotazione?')"
        >
          Cancella
        </button>
      </form>
      {% endif %}
    </div>
  </div>
  {% endfor %} {% else %}
  <div class="no-items">
    <p>Non hai ancora effettuato prenotazioni.</p>
    <a href="{{ url_for('index') }}" class="btn" style="margin-top: 1rem"
      >Prenota Ora</a
    >
  </div>
  {% endif %}
</div>

<div class="section">
  <h2>Ultime Transazioni</h2>
  {% if transazioni %}
  <ul class="transazione-list">
    {% for trans in transazioni %}
    <li class="transazione-item">
      <div>
        <div style="font-size: 0.9rem; color: #7f8c8d">
          {{ trans.created_at.strftime('%d/%m/%Y %H:%M') }} - {{
          trans.metodo_pagamento }}
        </div>
      </div>
    </li>
    {% endfor %}
  </ul>
  {% else %}
  <div class="no-items">
    <p>Nessuna transazione effettuata.</p>
  </div>
  {% endif %}
</div>

{% endblock %}
